const fs = require('fs');
const path = require('path');

function main() {
  const root = process.cwd();
  const srcPath = path.join(root, 'CoT_templates_collection.json');
  const outDir = path.join(root, 'src', 'generated');
  const outFile = path.join(outDir, 'builtinTemplates.ts');

  if (!fs.existsSync(srcPath)) {
    console.error('Source CoT_templates_collection.json not found at', srcPath);
    process.exit(1);
  }

  const raw = fs.readFileSync(srcPath, 'utf8');
  let parsed;
  try {
    parsed = JSON.parse(raw);
  } catch (err) {
    console.error('Failed to parse CoT_templates_collection.json:', err);
    process.exit(1);
  }

  fs.mkdirSync(outDir, { recursive: true });

  const fileContents = `// Auto-generated by scripts/generate-builtins.js â€” do not edit.
export const BUILTIN_MAIN_FILE = ${JSON.stringify(parsed, null, 2)} as const;

export default BUILTIN_MAIN_FILE;
`;

  fs.writeFileSync(outFile, fileContents, 'utf8');
  console.log('Wrote built-in templates to', outFile);
}

main();
